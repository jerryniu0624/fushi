# 医检阳性 不等于 得了病？ 重新理解贝叶斯公式

来源：https://www.bilibili.com/video/BV1Ei4y1F72M/?spm_id_from=333.999.0.0&vd_source=c7de7f0db3f529a4248072c60fc1d09a



## 通用公式介绍

你们中的一些人可能听说过这个关于医学测试的矛盾事实。它通常用于介绍概率中贝叶斯规则的话题。

![image-20230323203233054](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323203233054.png)

## 这种公式反直觉

矛盾的是，你可以参加一个非常准确的测试，因为它给大多数参加测试的人提供了正确的结果。然而，在特定的情况下，当你的测试结果是阳性时，你真正得病概率很低。简而言之，一个准确的测试不一定测得准。
现在，当人们想到数学和公式时，很少认为是人为设计出来的。当然，在选择“数字记号”时，人们上有很多看法。但是，当涉及到公式本身的结构以及我们如何使用它们时，人们通常认为这是定死的。



## 我们的新贝叶斯公式！

在这个视频中，你和我将深入探讨这个悖论，但我不想用它来谈论基本规则的通常版本，而是想引入另一套解释，一个另一套设计。

![image-20230323203850723](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323203850723.png)

现在，屏幕上的内容有点抽象，这使得很难证明这里真的有实质性的区别，尤其是当我还没有解释任何一个的时候。

然而，要明白我在说什么，我们真的应该花一些时间更具体地开始，并阐明这个悖论到底是什么。

![image-20230323204144978](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323204144978.png)

想象1000名女性，假设其中1%患有乳腺癌。假设他们都接受了一定的乳腺癌筛查，其中9名癌症患者得到了正确的阳性结果，还有一个假阴性。然后假设在其余没有癌症的人中，89人得到假阳性，901人正确得到阴性结果。

所以如果你只知道一个女人做了筛查，结果是阳性的，而且没有关于症状或类似的信息。她要么是这9个真阳性中的一个，要么是这89个假阳性中的一个。所以她在癌症组的概率，给定测试结果是9/（9+89），大约是11分之一。

用医学术语来说，你可以称之为测试的“阳性预测值”（Positive Predictive Value)，缩写PPV——真实阳性的数量除以阳性测试结果的总数，测试结果呈阳性在多大程度上实际上可以预测你患有这种疾病。
现在，正如我以这种方式呈现的那样，我们正在具体考虑样本人群，所有这些计算步骤都非常合理。但是如果你只看统计数据中测试的准确率，把它作为一个统计数据呈现给人们，然后让他们对测试结果做出判断，这是违反直觉的。



### 测试准确率

![image-20230323204757699](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323204757699.png)

测试的“准确率”其实不是一个值，而是两个值。

首先，你想知道患病人群中正确检出阳性的比例，这叫做检测的“灵敏度”（Sensitivity)，因为它反映了该检测对疾病的探知有多敏锐。在我们的示例中，测试灵敏度为9/10或90%。换而言之，是“漏诊率”或者“假阴性率”为10%。

另一个数与灵敏度没有直接关系，它是指对那些没有疾病的人来说检出阴性的比例，这被称为测试“特异度”（Specificity）。换而言之，“误诊率”或者“假阳性率”为9%。意思是，阳性结果是由疾病引起的，还是领有其他诱因导致假阳性。在我们的例子中，特异度约为91%。

所以这里的悖论是，一方面，测试的准确率超过90%。受试的患者中超过90%的人都得到正确的结果。然而，如果你知道有人得到了阳性的结果，且没有任何额外信息的情况下，实际上只有十一分之一的机会这个结果是准确的。这就有点奇怪了，因为数学的所有地方都是反直觉的，怎么偏偏医学测试这个非常重要的领域也出现这种情况！



### 这种反直觉的表现

在2006年和2007年，心理学家Gerd Gigernenzer为执业妇科医生举办了一系列统计研讨会。他开场举了个例子：一名50岁的妇女，没有症状，参加例行乳房x光检查。她测试呈阳性，感到震惊，想从你那里知道她是否患有乳腺癌，或者她的机会有多大。除了筛查结果，这个女人别的什么都没有。

在那次研讨会上，医生们被告知，这个年龄段的女性乳腺癌患病率约为1%。然后假设测试灵敏度为90%，特异度为90%。您可能会注意到这些数字与您和我刚才看到的示例完全相同，因为这是我得到它们的地方。我们既然已经彻底思考过，你和我都知道答案：大约是1/11。

![image-20230323210520241](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323210520241.png)

然而，本次会议中的医生并没有像之前我展示的那样，马上想象得到一千个人的样本。他们只看到这些数字。然后他们被问到，有多少检测呈阳性的女性实际上患有乳腺癌？最好的答案是什么？他们得到了这4个选择。在一次治疗中，超过一半的在场医生说正确答案是9/10，这相去甚远。只有五分之一的人给出了正确答案，这比每个人随机猜测的结果更糟糕。

把这称为悖论可能有点过了。毕竟这只是事实。这不是本质上自相矛盾的东西。但正如这研讨会所显示的那样，包括医生在内的人们肯定会发现，高准确度的测试决不会预测的这么差，我们可以把这称为一个验证悖论（Veridical Paradox）——某些事物能被证明是真，但当换种方式表述时，却会感觉是错误的。这是悖论中最温和的形式，更多地谈论人类心理，而不是逻辑。



## 解决这种反直觉的数学公式：换一种表达方式与形成体系

问题是我们如何解决这个问题。

![image-20230323211147570](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323211147570.png)

顺便说一句，我们要做的是，我希望你能够看到这样的数字，并在脑海中快速估计，这意味着阳性预测值应该在1/11左右。

![image-20230323211230131](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323211230131.png)

或者如果我改变一下，问：如果有10%的人患有乳腺癌呢？你应该能够很快明白，说最终答案会是50%多一点。

![image-20230323211337745](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323211337745.png)

或者如果我说，想象一个非常低的患病率，大约0.1%的患者患有癌症，你应该再次快速估计测试的预测值约为100分之一。

本例当中，患者检测前，真正患癌症的概率为1/100。用贝叶斯的话来说就是**“先验概率”**（Prior Probability）。这次检测将先验概率**增长**了一个数量级，变为1/11。**测试的准确性反映的是这种更新的幅度，而非最终答案。**

![image-20230323212014635](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323212014635.png)

这和快速估算有什么关系？这些近似值的依赖于一个关键数字叫做“**贝叶斯因子**”。定义这个数字就点名了今天的主题：**如何换个角度看检测的意义**。

![image-20230323212335948](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323212335948.png)

让测试数据如此令人困惑的一大原因在于，你会听到至少有4个有关数字。对于患有这种疾病的人，有敏感性和假阴率；对于没有这种疾病的人，有特异度和误判率。但是这些数字都没有告诉你你想知道的事情！

幸运的是，如果你想解释一个积极的测试结果，你可以利用上述4个值，算出一个特定的的结果来关注：敏感度除以误判率。换句话说，结果呈阳性时，具体有多大可能患病。

![image-20230323212655026](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323212655026.png)

在我们的示例中，这个数字是10。这就是贝叶斯系数，有时也称为“似然比”。



## 经验法则：先验概率*贝叶斯因子

![image-20230323213210946](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323213210946.png)

一个非常方便的经验法则是，要更新一个小的先验，或者至少要逼近答案，你只需将它乘以贝叶斯因子。所以在我们的例子中，如果先验概率较小，要更新这一概率，或者至少要接近于答案的话，只需要将其乘以贝叶斯系数即可。所以在本例中，如果先验概率是100分之一，你会估计最终结果应该在10分之一左右，这实际上略高于真正的正确答案。

![image-20230323213529953](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323213529953.png)

所以根据这个经验法则，如果我问你，如果前面的例子是千分之一，会发生什么，你可以很快估计测试的效果应该是将这些机会更新到一百分之一左右。

![image-20230323213922951](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323213922951.png)

事实上，花点时间考考自己，假如10000名患者中只有10人真正患有癌症。由于90%的敏感度，我们预计其中9例癌症病例会给出真阳性结果。另一方面，91%的特异度意味着9%没有癌症的人得到假阳性。所以我们预计剩下的9%的病人，大约900人，会给出假阳性结果。在如此低的患病率下，假阳性确实主导了真阳性。因此，从这个人群中随机选择的阳性病例实际上患有癌症的概率只有1%左右，就像经验法则预测的那样。

![image-20230323214101182](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323214101182.png)

现在，这个经验法则显然不适用于更高的先验概率。例如，如果先验概率为10%，经验法则会推出所有人100%患癌。但那不可能是对的。

![image-20230323214415535](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323214415535.png)

不妨再次基于样本人群，透彻地思考一下答案是啥。这次我们想象出100人中有10人患有癌症。同样，基于测试的90%灵敏度，我们预计这些真正的癌症病例中有9例会得到阳性结果。但是假阳性呢？我们预计会有多少人？大约在剩下的90个中占9%，大约有8个。因此，当看到阳性测试结果时，它会告诉你，你要么是这9个真阳性中的一个，要么是8个假阳性中的一个。所以这意味着几率略高于50。大约17人中有9人，即53%。
看到这里，如果你之前曾幻想：基于贝叶斯因子的更新看起来像乘法一样简单，你可能会放弃你的希望，务实地承认，有时生活比数学更复杂。



## 先验概率&更新完的概率：是比率（Odds）不是概率（Proportion）！！！

但其实没那么复杂！

只要我们吧讨论对象从概率（Probabillity）转向比率（Odds），这个经验法则就会变成一个精确的数学事实。

你曾经可能听到有人谈论一个事件的可能性是1比1或2比1之类的，你已经知道比率了。谈及概率时，我们求的是阳性个体数与总个体数的比率，比如五分之一或十分之一。谈及比率时，你要做的就是计算所有阳性个体数与所有阴性个体数的比值。比率通常会用冒号的形式，以示区别，但它仍然只是一个分数，只是一个数字。

![image-20230323215005099](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323215005099.png)

因此，概率为50%的事件被描述为具有一对一的比率。10%的概率等于1比9的比率，80%的概率等于4比1的比率。你明白了。这是相同的信息。比率仍然描述了随机事件的机会，但呈现方式略有不同，就像不同的单位系统一样。

![image-20230323215054179](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323215054179.png)

概率限制在0和1之间，机会对半分时概率为0.5，但比率从0到无穷大不等，机会对半分时比率为1。

![image-20230323215410031](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323215410031.png)

这个美妙的方法，把近似都能抛到一边，可以完全准确地构造出贝叶斯公式：将先验概率改用比率表示，然后再乘上贝叶斯公式就行了。

![image-20230323220429370](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323220429370.png)

想想这里的先验比率的含义：就是癌症患者的数量除以没有癌症的人数。

让我们把它写成一个正常的分数，这样我们就可以乘以它。  

当你把范围限定在结果呈阳性的人时，则真正患癌者的数目应该乘以一个小因数：在确定患癌的人群中，检测出阳性的概率。同样的，未患癌的数目相应地乘上小因数：在建康的人群中，检测出阳性的概率。因此，两者再一除，也就是检测后更新的比值，看起来跟检测前的比值很像，但多乘的这一项正是贝叶斯因子。

![image-20230323220653660](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323220653660.png)

回顾我们的例子，贝叶斯因子是10，这来自90%的敏感度除以9%的假阳率。也就是说，出现阳性结果时，真实情况多倾向于有癌症而非没癌症。

![image-20230323221226520](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323221226520.png)

如果先验概率是1%，用比率表示则是1：99。所以根据我们的规则，它会更新到10：99，如果你愿意，你可以转换回概率。它将是10/（10+99），或者大约1/11。

![image-20230323221136929](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323221136929.png)

如果先验概率是10%，写成比率就是1：9。根据这里的简单规则，它会更新到10：9，你已经可以很直观地读出来了。这有点高于1：1。如果您愿意，您可以将其转换回概率。你会把它写成10/19，或者大约53%。事实上，这就是我们通过对样本人群进行思考而发现的。

![image-20230323221546878](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323221546878.png)

假设我们回到之前1%的人群患病率，但让测试更准确：假阳率只有1%而不是9%呢？这意味着我们的贝叶斯系数是90而不是10。在这种情况下，测试为我们做了更多的工作。有了更准确的测试，它会更新到90：99，这略小于50%。你可以换算回概率，算出它大约是48%。但老实说，如果你只是为了直观感受，那有比率的结果就够了。

你明白我的意思吗，仅仅定义这个数字就能帮助消除潜在误解。对将测试准确性直接与您患疾病的概率联系起来的人来说，我们最好强调一点，即使在每种情况下都保持不变的检测的准确率，病人们的检测结果也都一样。但在不同背景下，这个检测结果也会有不一样的意义。

![image-20230323222240184](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323222240184.png)

然而，有一件东西在每种情况下都保持不变：那就是用来更新病人的先验“比率“是，乘上的倍数。



## 先验概率的补充定义

![image-20230323222458847](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323222458847.png)

顺便说一句，在整个过程中，我们一直在使用这种疾病的流行率作为先验概率（比率）：人口中患有这种疾病的人的比例。然而，情况不一定如此。如果有其他已知的因素，比如症状，或者在传染病模型下，比如已知的接触者，这些因素也会影响到先验概率，并且可能会产生巨大的影响。

![image-20230323222617348](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323222617348.png)



## 阴性情况的补充

另外，到目前为止，我们只讨论了阳性测试结果。但是更多的时候，你会看到阴性的测试结果。这在逻辑上完全相同，但您计算的贝叶斯因子看起来会有所不同。这里你将看到：你会看到已知阴性结果下有疾病和没有疾病的比例。在我们的癌症例子中，这是10%的假阴率除以91%的特异度，或者大约九分之一。换句话说，在这个例子中看到一个阴性的测试结果会**降低**你的先验概率大约一个数量级。

![image-20230323223026693](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323223026693.png)

当你把它写成一个公式时，它看起来是这样的。它说你在测试后患疾病的几率等于你在测试前患疾病的几率（也就是先验概率）乘以贝叶斯因子。



## 新公式转换为通用公式

![image-20230323224313095](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323224313095.png)

现在，让我们将其与通常的贝叶斯规则进行对比，通常这有点复杂。这本质上就是我们对样本人群所做的事情。但你用符号概括了起来。还记得我们总是计算真阳性的数量，然后将其除以真阳性和假阳性的总和。我们是这样做的，但不把它们看作绝对计数（absolute amount），而是将每个数量作为一个比例（proportion）。因此，人群中真正阳性的概率 等于 患病的先验概率乘以在这种情况下看到阳性测试结果的概率。然后我们将这个复制到分母中。假阳性的概率 等于 没有疾病的先验概率乘以这种情况下测出阳性的概率。

![image-20230323224526062](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323224526062.png)

如果你愿意，你也可以用文字而不是符号写下来，如果敏感度和假阳率等术语听上去更舒服的话。这一类公式，一旦你完整说出来，它似乎有点多，但它确实与我们对样本人群所做的没有什么不同。

![image-20230323224829366](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323224829366.png)

如果你想让整个事情看起来更简单，你经常会看到整个分母写成检测为阳性的总概率。虽然这确实是一个非常优雅的小表达，但如果你打算用它来计算，这有点不诚实。因为在实践中，每次你这样做，你都需要把分母分解成两个独立的部分：假阳+真阳。

![image-20230323225334272](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323225334272.png)

因此，以这个更诚实的表示，让我们比较我们的两个贝叶斯的版本。同样，如果我们使用敏感性和误判率这个词，也许看起来会更清楚。不提别的，它有助于强调公式的哪些部分来自统计数据。
其实我最喜欢的一点是，把比率和贝叶斯因素联系到一起时，它清楚地分开与先验有关的部分和与测试精度有关的部分。但在通常的公式中，所有这些都混杂在一起。



## 新方法的优点1：便于更新计算

![image-20230323230027615](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323230027615.png)

这有一个非常实际的好处：如果你想交换不同的先验就能轻松看到它们的效果，比如你检测了两次而不是一次，或者你想知道症状的存在有多少影响。你每次看到一个新症状时，你都会问同一个问题：在患者身上看到这种症状的概率比在未患病的人身上要高多少？这个问题的每一个答案都会给出一个新的贝叶斯因子：一个你和比率相乘的新东西。



### 新方法的优点2：便于理解检测结果与得病的关系

![image-20230323230306216](C:\Users\17735\AppData\Roaming\Typora\typora-user-images\image-20230323230306216.png)
除了让计算变得更容易之外，我还非常喜欢它的一点：在检测精度上，附加一个看起来一点都不像概率的数字。如果你听说一个测试有，例如，9%的误判率，这只是一个灾难性的模棱两可的短语！很容易误解成：你的阳性测试结果有9%的可能性是错误的。

但是想象一下，如果我们听到是附加在测试结果上是阳性测试结果的贝叶斯因子为，比如说，10，那么贝叶斯因子和你得病概率就无法混淆了。

因为，贝叶斯因素基于的整个框架是它只作用于先验。它迫使你承认先验是独立的，是得出任何结论所必需的。



## 通常的公式的优点

尽管如此，通常的公式肯定不是没有优点的。如果你认为它不仅仅是插入数字的东西，而是我们常用的样本思想的总体概括，你可以很容易地认为这实际上更加符合你的直觉。毕竟，我们连计算贝叶斯因子是否有意义都要不停回到原始的公式上检查。这是我们经常依赖的，以便检查自己，贝叶斯因子计算在第一时间是否有意义。



## "贝叶斯因子"vs"似然比"补充

注:本集中"贝叶斯因子"和"似然比"是互通的，但一般情况两者并不互通。本集中我们只假设了两种可能结果——要么得病，要么没得病。而当你想要预估的参数为连续的时候，"贝叶斯因子"和"似然比"虽有关联，但也有很大差别。它们分别代表了预估参数的不同方法。